{% extends "main/base.html" %}
{% load static %}
{% block title %}Запись на услугу{% endblock %}
{% block content %}
<div class="booking-page">
    <h1>Запись на услугу: {{ service.name }}</h1>

    <form method="post">
        {% csrf_token %}
        <label for="date">Выберите дату:</label>
        <input type="text" id="date" name="date" class="date-picker" required>

        <label for="time">Выберите время:</label>
        <select id="time" name="time" class="time-picker" required>
            <!-- Временные слоты будут добавлены через JavaScript -->
        </select>

        <button type="submit" class="button">Записаться</button>
    </form>
</div>
{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="{% static 'main/css/booking.css' %}">
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            flatpickr(".date-picker", {
                dateFormat: "Y-m-d",
                altInput: true,
                altFormat: "F j, Y",
                minDate: "today",
                onChange: function(selectedDates, dateStr, instance) {
                    fetch(`/api/get_available_times/?date=${dateStr}&specialist_id={{ service.specialist.id }}&service_id={{ service.id }}`)
                        .then(response => response.json())
                        .then(data => {
                            const timePicker = document.getElementById("time");
                            timePicker.innerHTML = "";
                            data.available_times.forEach(time => {
                                const option = document.createElement("option");
                                option.value = time;
                                option.textContent = time;
                                timePicker.appendChild(option);
                            });
                        });
                }
            });
        });
    </script>
{% endblock %}